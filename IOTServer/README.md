# 数据库

电池：PID，电压，温度，电量

电车：VID，PID，灯光状态，车辆状态（正常1、暂停2、温度异常3、电量不足4、需要救援5）

电池消费记录：PID、VID、时间、容量、温度

# 操作

## 电车

- 电车上电后发送复位消息： `{"VID":2001,"state":"reset"}`。注意，这是必须的第一步。

  子任务：

  - 修改电车状态为 1
  - 告知前端：`{"VID":2001,"state":1}`
  - 返回系统时间：`{"VID":2001,"clock":"2024-07-08 15:47:30"}`

- 电车与服务器断开连接。

  子任务：

  - 修改电车状态为 2
  - 告知前端：`{"VID":2001,"state":2}`

- 电车定时发送坐标，以及车载电池电压、温度。由于电车可能意外与服务器断开连接，重连后会一次性发送这段时间内的数据。因此与硬件约定，此类消息均发送 JSON 数组格式，如：`[{"VID":2001,"localTime":"2024-07-08 14:22:56","PID":1002,"Temperature":38.9,"v":7.3,"x":100,"y":150}]`。

  电池容量由电压计算得来：`power = (v - v_min) / (v_max - v_min)`。

  子任务：

  - 修改电车携带的电池 PID
  - 修改电池信息
  - 增加一条电池消费记录
  - 告知前端电车坐标：`{"VID":2001,"x":100,"y":150}`

- 硬件发送报警（温度异常、电量不足、需要救援）。

  `{"VID":2001,"state":"Temp Warning"}`

  `{"VID":2001,"state":"Volt Warning"}`

  `{"VID":2001,"state":"Rescue Warning"}`

  子任务：

  - 修改电车状态
  - 告知前端

- 硬件恢复正常：`{"VID":2001,"state":"Normal"}`。

  子任务：

  - 修改电车状态
  - 告知前端

## 前端

- 前端查询电池消费记录

- 前端设定电车位置

- 前端发送充电提醒

- 前端控制近光灯

  子任务：

  - 修改电车灯光状态
  - 通知硬件

- 前端控制喇叭
- 前端查询在线车辆 VID、PID、电池电压、电池温度、电池电量、灯光状态、电车状态
- 前端上传地图文件（0 路 1 换电站 2 障碍）
- 前端读取地图
